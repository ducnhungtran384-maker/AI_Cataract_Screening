项目文件分析报告

一、项目概述
本项目旨在构建 AI 辅助白内障筛查系统，涵盖数据清洗、数据增强、模型训练、模型评估、可视化展示以及自动化报告生成等完整流程。代码主要使用 Python (PyTorch, Pandas, OpenCV) 技术栈，实现了从原始医疗影像到临床辅助诊断报告的全链路闭环。

二、主要代码脚本说明 (01_Code_Scripts 文件夹)

为了便于理解，将文件夹内的脚本分为五大功能模块：

1. 数据工程模块 (Data Engineering)
核心职责：保障输入数据的高质量与规范性。

    classify.py
    功能：基于 Excel 临床诊断表的关键词（正则匹配），将原始非结构化图片分拣至 Normal/Cataract 文件夹。
    关键点：支持 lens opacity 等模糊语义匹配，自动忽略无关病种。

    remove_duplicate.py
    功能：计算图片文件的 MD5 哈希值，物理删除内容完全相同但文件名不同的重复图片。
    关键点：防止数据污染，确保训练集与测试集严谨隔离。

    cataract_data_augmentation_fixed.py
    功能：针对白内障样本稀缺问题，构建眼科专用增强管线（旋转、翻转、色温调整），扩充数据至平衡状态。
    关键点：增强前后自动合并数据集并重名为连续序列，解决类别不平衡。

    split_data.py
    功能：使用固定随机种子（Seed=42），按 8:2 比例将清洗后的数据划分为 Train/Test 集合。
    关键点：确保实验的可复现性，支持断点重练。

    check_dataset.py
    功能：从文件数量、格式、读取有效性三个维度快速扫描数据集。
    关键点：在训练前拦截破损文件，避免训练中途崩溃。

    find_mismatches.py
    功能：查找是否存在标签与文件名不符或图像损坏的异常样本。
    关键点：作为数据清洗的最后一道防线。

2. 模型训练与开发模块 (Model Development)
核心职责：构建并训练深度学习模型。

    trainer_template.py
    功能：ResNet18 迁移学习的主训练脚本，包含加载 ImageNet 权重、冻结浅层、微调全连接层。
    关键点：实现最佳权重保存 (best_cataract_model.pth) 和训练曲线记录。

    check_model.py
    功能：检查 .pth 模型文件的结构完整性，打印网络层级信息。
    关键点：验证下载或保存的模型是否损坏。

3. 模型评估与测试模块 (Evaluation & Testing)
核心职责：多维度量化模型性能。

    evaluate_model.py
    功能：加载模型对测试集进行全量推理，计算 Accuracy, Precision, Recall, F1 等医学指标，并自动注入到前端 data.js。
    关键点：实现了 Python 后端到 Web 前端的数据桥接，是自动化看板的核心。

    test_only.py
    功能：加载模型并在测试集上运行推理，仅在控制台打印混淆矩阵与核心指标，不修改任何文件。
    关键点：用于快速验证模型效果的只读模式脚本。

    verify_model.py
    功能：对比不同批次或不同环境下的模型推理结果，确保一致性。
    关键点：排除环境差异导致的推理偏差。

    analyze_errors.py
    功能：深度分析分类错误的样本，统计误判的置信度分布。
    关键点：帮助理解模型为什么错，为针对性优化提供依据。

    compare_errors.py
    功能：比较两个不同模型（如 ResNet18 vs VGG）在同一批错误样本上的表现。
    关键点：用于模型选型对比。

4. 可视化与可解释性模块 (Visualization & Interpretability)
核心职责：打开黑盒，让 AI 决策透明化。

    gradcam_helper.py
    功能：封装 Grad-CAM 算法类，计算卷积层梯度热力图。
    关键点：核心算法库，被其他脚本调用以生成热力图。

    generate_gradcam_batch.py
    功能：批量读取测试集图片，调用 GradCAM 类生成对应的热力图并保存。
    关键点：为前端看板预生成所有展示用的热力图素材。

    generate_tsne.py
    功能：提取模型倒数第二层的 512 维特征，使用 t-SNE 算法降维至 2D 平面绘图。
    关键点：直观展示模型对正常与病变样本的特征分离程度。

    generate_wordcloud.py
    功能：扫描项目代码和文档，提取高频关键词生成项目词云。
    关键点：用于报告封底或概览页的视觉点缀。

    visualize_errors.py
    功能：将误判图片及其预测概率拼接成图，便于人工审核。
    关键点：生成错题集视图。

5. 报告系统与辅助脚本 (Report system)
核心职责：整合资源自动生成报告。

    convert_md_to_html.py
    功能：将 Markdown 转换为单文件 HTML，通过 Base64 编码嵌入所有图片。
    关键点：生成无需依赖外部文件夹、易于分发的 Web 版报告。

    convert_md_to_docx.py
    功能：将 Markdown 报告转换为格式精美的 Word 文档，支持代码高亮、图片嵌入、页码插入。
    关键点：为最终的 PDF 输出提供高质量的 Word 底稿。

    finalize_report.py
    功能：对生成的 DOCX 进行最终排版（更新目录、页边距）并导出 PDF。
    关键点：生成出版级 PDF 报告的关键步骤。

    auto_build.py
    功能：自动化构建脚本，依次执行依赖检查、数据生成、可视化更新等步骤。
    关键点：项目的 CI/CD 入口脚本。

    patch_data_js.py
    功能：专门用于修补或全量更新前端 data.js 文件的某个字段。
    关键点：可以只更新数据而不重跑整个评估流程。

三、总结
本项目脚本库覆盖了从 数据准备 -> 模型研发 -> 结果评估 -> 可视化解释 -> 自动化报告 的全生命周期。代码设计遵循模块化原则，既有专注于单一算法的 helper 脚本，也有串联流程的 auto 脚本，共同支撑起高效的 AI 科研工作流。
